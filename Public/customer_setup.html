<html>
<head>

	<meta charset="utf-8">
    <title>DroidHomes-Admin</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <!-- site css -->
    <link rel="stylesheet" href="/static/dist/css/site.min.css">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">
    <!-- <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'> -->
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
		    <script src="/socket.io/socket.io.js"></script>

    <script type="text/javascript" src="/static/dist/js/site.min.js"></script>

	<link rel="stylesheet" type="text/css" href="/static/css/site.css">
	<link rel="stylesheet" type="text/css" href="/static/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/static/css/jquery.dataTables.min.css">

	
    <script src="js/bootstrap.js"></script>
	<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>

	<script type="text/javascript" src="/static/js/site.js"></script>
	<script type="text/javascript" src="/static/js/sweetalert.min.js"></script>
	<script type="text/javascript" src="/static/js/mustache.js"></script>
    <script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
	

	<script type="text/javascript">
		window.cameras = [];
	</script>

</head>
<body>
	    <!--nav-->
    <nav role="navigation" class="navbar navbar-custom">
        <div class="container-fluid">
          <!-- Brand and toggle get customered for better mobile display -->
          <div class="navbar-header">
            <button data-target="#bs-content-row-navbar-collapse-5" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">DroidHomes-Admin</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div id="bs-content-row-navbar-collapse-5" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown">
                <a data-toggle="dropdown" class="dropdown-toggle" href="#">Account <b class="caret"></b></a>
                <ul role="menu" class="dropdown-menu">
                  <li class="dropdown-header">Setting</li>
                </ul>
              </li>
              <li class="active"><a href="/logout">Logout</a></li>
            </ul>

          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>

	<div class="container-fluid">


		<div class="row row-offcanvas row-offcanvas-left">
          <div class="col-xs-6 col-sm-3 sidebar-offcanvas" role="navigation">
  <ul class="list-group panel">
  <li class="list-group-item"><i class="glyphicon glyphicon-align-justify"></i> <b>Navigation</b></li>
  <!-- <li class="list-group-item"><input type="text" class="form-control search-query" placeholder="Search Something"></li> -->
  <li class="list-group-item"><a href="/dashboard"><i class="glyphicon glyphicon-home"></i>Dashboard </a></li>
  <li class="list-group-item"><a href="/customers"><i class="fa fa-users" onclick="loc()"></i>Customers </a></li>
  
</ul>
          </div>
          <div class="col-xs-12 col-sm-9 content">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title"><a href="javascript:void(0);" class="toggle-sidebar"><span class="fa fa-angle-double-left" data-toggle="offcanvas" title="Maximize Panel"></span></a> Customer Setup</h3>
              </div>
              <div class="panel-body">
                  <div class="content-row">
                    <h2 class="content-row-title"> Customer Setup
                    </h2>

                    <div class="row">

						<div class="col-md-12">
                    		<h4>Step 1 : Configure Security Camera </h4>
                    		<hr>
                    	</div>
						
						<div class="col-md-12">
							<div> 
								<h4>Camera Setting</h4>
								<hr>
								<div class="pull-right">
									<button type="button" class="btn btn-success" data-toggle="modal" data-target="#addcameraModal">Add Camera</button>
								</div>
								<div style="clear:both"></div>
								<div style="margin-top:10px;">
									<table class="display" id="cameras-table" >
										<thead>
											<tr class="info" data-search-term="abcdefghifjlmnopqrstuiwxyz">
												<td>Product Type</td>
												<td>Product Name</td>
												<td>PI mac address</td>
												<td>Module Number</td>
												<td>PI Port</td>
												<td>PI Token</td>
												<td>Global IP</td>
												<td>Edit</td>
												<td>Delete</td>

												
											</tr>
										</thead>
									<!---	<tbody>

										<tr class="danger" data-search-term="{{camera.title}}{{camera.type}}{{camera.address}}">
											<td>{{loop.index}}</td>
											<td>
												{{camera.name}}
											</td>
											<td>
												{{camera.camera_code}}
											</td>
											<td>
												{{camera.pi_mac}}
											</td>
											<td>
												{{camera.port}}
											</td>
											<td>
												<textarea readonly>{{camera.token}}</textarea>
											</td>
											<td>
												{{camera.globalip}}
											</td>
											<td> 
												<a href="#" data-toggle="modal" class="edit-camera-anchor" data-target="#editcameraModal" data-id="{{camera._id}}" title="Edit"><i class="glyphicon glyphicon-pencil"></i></a>  
												<a href="#" class="delete-camera-anchor" title="Delete"  data-id="{{camera._id}}"><i class="glyphicon glyphicon-remove"></i></a>

												
											</td>
										</tr>
									
										</tbody> -->
									</table>
								</div>

								
								<div class="alert alert-warning" style="margin-top:10px;">
									<p>No cameras added. Start by adding a New one.</p></div>
							

							</div>
						</div>


                    </div>
                  </div>

              </div><!-- panel body -->
            </div>
        </div><!-- content -->

	</div>
	</div>
	<script>
	var url = document.URL;
	console.log(url);
	</script>


  <!-- Automated Modal content-->
  <div id="addcameraModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title text-center">Add New camera</h4>
        </div>
        <div class="modal-body">
					<form action="" method="post" id="add-camera-form">
						<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Product Type</label>
					<div class="col-sm-10">
					<select name="product_type" onchange='check_value(this.value);'>
    <option value="camera">Camera</option>
    <option value="lock">Lock</option>
    <option value="cameralock">Camera+Lock</option>
  </select>
					</div>
				</div>
						</div>
			<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Module Number</label>
					<div class="col-sm-10">
						<input type="text" value="null" class="form-control" name="module_number" id="m_no" style="display:none;" placeholder="Module Number">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Name</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="name" id="" placeholder="Camera Name">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">PI Mac Address</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="pi_mac" id="" placeholder="PI Mac Address">
					</div>
				</div>
				
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Port</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="port" id="" placeholder="Port">
					</div>
				</div>
				<div class="form-customer row">
					<!---<label for="emailInput" class="col-sm-2 col-form-label">Port</label>-->
					<div class="col-sm-10">
						<input type="submit" class="form-control" value="Submit" >
					</div>
				</div>

			</div>
		</form>
        </div>
        <div class="modal-footer text-center">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>






  <div id="editcameraModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title text-center">Edit camera</h4>
        </div>
        <div class="modal-body">
          <form action="/editcamera" method="post" id="edit-camera-form">
			<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Name</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="name" id="" placeholder=" Name">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">PI Mac</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" name="pi_mac" id="" placeholder="PI Mac">
					</div>
				</div>
				
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Port</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="port" id="" placeholder="Image">
					</div>
				</div>


				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Global IP</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="globalip" id="" placeholder="Global IP">
					</div>
				</div>

					<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label"></label>
					<div class="col-sm-10">
						<input type="submit" class="form-control" value="Submit">
					</div>
				</div>


			</div>
		</form>
        </div>
        <div class="modal-footer text-center">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>



  <!-- Add Module content-->
  <div id="configurePiModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title text-center">Add Pi Modal</h4>
        </div>
        <div class="modal-body">
          <form action="" id="add-pi-form">
			<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Pi Name</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="pi_name" id="" placeholder="Pi Name">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Mac Address</label>
					<div class="col-sm-10">
						<input type="number" value="" class="form-control" name="mac_address" id="" placeholder="Mac Address">
					</div>
				</div>

			</div>
		</form>
        </div>
        <div class="modal-footer text-center">
          <button type="button" class="btn btn-info" id="add-pi-btn">ConfigurePI</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>




	<div id="ajaxLoader" style="display:none;"></div>
</body>





<!-- template to maintain moduleList container -->
<script type="template" id="moduleList-template">

	{% raw %}

		{{^moduleList.length}}
			<div class="alert alert-warning"> No modules added for this camera </div>
		{{/moduleList.length}}


		{{#moduleList.length}}
	    
	    <table class="table table-bordered">
			<tr class="info" data-search-term="abcdefghifjlmnopqrstuiwxyz">
				<td>Module ID</td>
				<td>Frequency</td>
				<td>Switches</td>
				<td>Has Dimmer</td>
				<td></td>
			</tr>
			{{#moduleList}}
			<tr class="danger">
				<td>{{module_name}}</td>
				<td>{{frequency}}</td>
				<td>{{no_of_switches}}</td>
				<td>{{has_dimmer}}</td>
				<td>
					<a href="#" class="list-switch-anchor" title="List Switches"  data-id="{{_id.$oid}}"><i class="glyphicon glyphicon-pencil"></i></a> 
				</td>

			</tr>
			 {{/moduleList}}
		</table>

		{{/moduleList.length}}
   {% endraw %}
</script>



<!-- template to maintain switches container -->
<script type="template" id="switchList-template">

	{% raw %}

		{{^switchList.length}}
			<div class="alert alert-warning"> No modules added for this camera </div>
		{{/switchList.length}}


		{{#switchList.length}}
	    
	    <table class="table table-striped table-bordered">
			<tr>
				<td>Switch Name</td>
				<td>Switch Id</td>
			</tr>
			{{#switchList}}
			<tr>
				<td>
				 <input type="text" value="{{name}}" name="switch-{{name}}" placeholder="Switch Name" />
				</td>
				<td>
					<input type="text" value="{{id}}" name="id-switch-{{name}}" placeholder="Switch Id" readonly />	
				</td>
			</tr>
			 {{/switchList}}
		</table>

		{{/switchList.length}}
   {% endraw %}
</script>


<!-- Edit switch to maintain switches container -->
<script type="template" id="editSwitchList-template">

	{% raw %}

		{{^switchList.length}}
			<div class="alert alert-warning"> No modules added for this camera </div>
		{{/switchList.length}}


		{{#switchList.length}}
	    
	    <table class="table table-striped table-bordered">
			<tr>
				<td>Switch Name</td>
				<td>Switch Id</td>
			</tr>
			{{#switchList}}
			<tr>
				<td>
				 <input type="text" value="{{name}}" name="switch-{{name}}" placeholder="Switch Name" />
				</td>
				<td>
					<input type="text" value="{{odd_id}}" name="id-switch-{{name}}" placeholder="Switch Id" readonly />	
				</td>
			</tr>
			 {{/switchList}}
		</table>

		{{/switchList.length}}
   {% endraw %}
</script>








<script>
	var t
		
var socket=io.connect("http://localhost:3000")

					
							socket.on('camdata',function(camresult){
								//console.log(camresult)
								console.log("updating camera table")
								
							if(typeof t === 'undefined')
							{
							t=$('#cameras-table').dataTable({
   "data": camresult,
   "columns": [
		 { "data": "ptype" },
      { "data": "name" },
      { "data": "maddr"},
			{ "data": "mno"}, 
			{ "data": "port"},
			{ "data": "pitoken"},
			{ "data": "globalip"},
			{ 
         "data": "pitoken",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="#" data-toggle="modal" class="edit-camera-anchor" data-target="#editcameraModal" data-id="'+data+'" title="Edit" onclick="editclicked(this)"><i class="glyphicon glyphicon-pencil"></i></a>';
								//console.log(data);
            }
            
            return data;
         }
      },
			{ 
         "data": "pitoken",
         "render": function(data, type, row, meta){
            if(type === 'display'){

							data='<a href="#" class="delete-camera-anchor" title="Delete" onclick="deleteclicked(this)" data-id="'+data+'"><i class="glyphicon glyphicon-remove"></i></a>'								
            }
            
            return data;
         }
      }
			
   ]
							});}
							else{
								t.fnDestroy()
									t=$('#cameras-table').dataTable({
   "data": camresult,
   "columns": [
		 { "data": "ptype" },
      { "data": "name" },
      { "data": "maddr"},
			{ "data": "mno"},  
			{ "data": "port"},
			{ "data": "pitoken"},
			{ "data": "globalip"},
			{ 
         "data": "pitoken",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="#" data-toggle="modal" class="edit-camera-anchor" data-target="#editcameraModal" data-id="'+data+'" title="Edit" onclick="editclicked(this)"><i class="glyphicon glyphicon-pencil"></i></a>';
								//console.log(data);
            }
            
            return data;
         }
      },
			{ 
         "data": "pitoken",
         "render": function(data, type, row, meta){
            if(type === 'display'){

							data='<a href="#" class="delete-camera-anchor" title="Delete" onclick="deleteclicked(this)" data-id="'+data+'"><i class="glyphicon glyphicon-remove"></i></a>'								
            }
            
            return data;
         }
      }
			
   ]
							});
							}
							})

	$(".edit-camera-anchor").click(function(){
		var id = $(this).data('id');
		console.log("clicked",id);

		for(i=0;i<window.cameras.length;i++){
			if(id==window.cameras[i]['id']){
				window.current_camera = window.cameras[i];


				$("[name='edit-name']").val(current_camera.name);
				$("[name='edit-pi_mac']").val(current_camera.pi_mac);
				$("[name='edit-port']").val(current_camera.port);
				$("[name='edit-globalip']").val(current_camera.globalip);

				break;
			}
		}
	});


	$("[name='no_of_switches']").change(function(){

		if($("[name='module_name']").val() == ""  || $("[name='module_name']").val() == undefined ){
			swal("Error", "Module Id is mandatory to configure switches", "error");
			return;
		}



		if( $(this).val() == "selectswitch"){
			swal("Error", "Please select a value", "error");
		}else{

			var module_name = $("[name='module_name']").val();
			var switchList = []

			for(i=0; i< $(this).val(); i++){
				switchList.push({
					name : "switch#"+(i+1),
					id : (i+1)
				})
			}

			window.renderSwitchList(switchList)

		}
	});

	$("[name='module_name']").on({
	  keydown: function(e) {
	    if (e.which === 32)
	      return false;
	  },
	  change: function() {
	    this.value = this.value.replace(/\s/g, "");
	  }
	});

	



window.renderModuleList =  function (list) {
    var template = $('#moduleList-template').html();
    
    var rendered = Mustache.render(template, {
        moduleList : list
    });

    $('#moduleList-result').html(rendered);

}


window.renderSwitchList =  function (list) {
    var template = $('#switchList-template').html();
    
    var rendered = Mustache.render(template, {
        switchList : list
    });

    $('#switchList-result').html(rendered);

}

window.renderViewSwitchList =  function (list) {
    var template = $('#editSwitchList-template').html();
    
    var rendered = Mustache.render(template, {
        switchList : list
    });

    $('#viewSwitchList-result').html(rendered);

}
function editclicked(elem){
	var v = $(elem).attr("data-id")
	socket.emit("cameraid",v)

}
	function deleteclicked(elem){
	var v = $(elem).attr("data-id")
	socket.emit("deletecamera",v)
	setTimeout(delay,500)
	function delay()
	{
		url = window.location.href
			$.get(url,function(){
				var socket=io.connect("http://localhost:3000")
				console.log("front-end get request");


		})
	}
}


//window.onload = function(){
	//console.log("window loaded")

	//var socket=io.connect("http://localhost:3000")
	//socket.on('updateid',function(data){
		//console.log("update command received")
		//url = '/customer/setup/'+data
	
		//console.log(url);
		var url = window.location.href;
		console.log(url);
		$.get(url,function(){
			var socket=io.connect("http://localhost:3000")
				console.log("front-end get request");


		})
	//})

//}

function check_value(val)
{
	var element=document.getElementById('m_no');
 if(val=='lock'||val=='cameralock')
 {
	 element.value=""
   element.style.display='block';
 }
 else  
   element.style.display='none';
}



</script>
</html>