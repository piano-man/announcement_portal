<html>
<head>
			    <script src="jquery-3.1.1.min.js"></script>
					 <script type="text/javascript" src="https://cdn.datatables.net/r/dt/dt-1.10.9/datatables.min.css"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/r/dt/dt-1.10.9/datatables.min.js"></script>

	   <meta charset="utf-8">
    <title>DroidHomes-Admin</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <!-- site css -->
    <link rel="stylesheet" href="/static/dist/css/site.min.css">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="/static/dist/js/site.min.js"></script>

	<link rel="stylesheet" type="text/css" href="/static/css/site.css">
	<link rel="stylesheet" type="text/css" href="/static/css/sweetalert.css">
 <link rel="stylesheet" type="text/css" href="/static/css/jquery.dataTables.min.css">

	
    
	<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
    <script src="/socket.io/socket.io.js"></script>

	<script type="text/javascript" src="/static/js/site.js"></script>
	<script type="text/javascript" src="/static/js/sweetalert.min.js"></script>
	<script type="text/javascript" src="/static/js/mustache.js"></script>
  <script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>



</head>
<body>
	<button type="button" id="addRow" > </button>
	    <!--nav-->
    <nav role="navigation" class="navbar navbar-custom">
        <div class="container-fluid">
          <!-- Brand and toggle get customered for better mobile display -->
          <div class="navbar-header">
            <button data-target="#bs-content-row-navbar-collapse-5" data-toggle="collapse" class="navbar-toggle" type="button">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">DroidHomes-Admin</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div id="bs-content-row-navbar-collapse-5" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown">
                <a data-toggle="dropdown" class="dropdown-toggle" href="#">Account <b class="caret"></b></a>
                <ul role="menu" class="dropdown-menu">
                  <li class="dropdown-header">Setting</li>
                </ul>
              </li>
              <li class="active"><a href="/logout">Logout</a></li>
            </ul>

          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>

	<div class="container-fluid">


		<div class="row row-offcanvas row-offcanvas-left">
          <div class="col-xs-6 col-sm-3 sidebar-offcanvas" role="navigation">
            <div w3-include-html="navs_container.html"></div>
						
						
          <script>
            w3.includeHTML();
          </script>
          </div>
          <div class="col-xs-12 col-sm-9 content">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title"><a href="javascript:void(0);" class="toggle-sidebar"><span class="fa fa-angle-double-left" data-toggle="offcanvas" title="Maximize Panel"></span></a> Customers</h3>
              </div>
              <div class="panel-body">
                  <div class="content-row">
                    <h2 class="content-row-title"> Customers
                    </h2>

                    <div class="row">
                      	<div class="text-center col-md-12">
                      		<div class="pull-right">
                      			<ul class="nav nav-pills text-uppercase">
                  				<li> 
									<button type="button" class="btn btn-success" data-toggle="modal" data-target="#addCustomerModal">Add Customer</button>
							 	</li>
								
							</ul>
                      		</div>
						</div>
						<div style="padding:20px;">
						
						</div>
						

						
					<!---	<div class="col-md-12">
							<table class="display" id="customers-table">
								<thead>
									<tr class="info" data-search-term="abcdefghifjlmnopqrstuiwxyz">
										<th>CustomerCode</th>
										<th>Address</th>
										<th>Contact</th>
										<th>Email</th>
										<th>FirstName</th>
										<th>LastName</th>
										<th>Password</th>
										<th>Setup</th>
										
									</tr>
								</thead>
					
							</table>
						</div>-->
						<div class = "col-md-12">
							<table class="display" id="example">
    <thead>
        	<tr>
										<th>Address</th>
										<th>Contact</th>
										<th>Email</th>
										<th>First Name</th>
										<th>Customer Id</th>
										<th>Last Name</th>
										<th>Setup</th>
										<th>Password</th>
										<th>Action</th>
										<th>Delete</th>
										
									</tr>
    </thead>
</table>
						</div>

				

                    </div>
                  </div>

              </div>
            </div>
        </div>

	</div>
	</div>


	  <!-- Automated Modal content-->
  <div id="addCustomerModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title text-center">Add New Customer</h4>
        </div>
        <div class="modal-body">
          <form action="/customers"  method = "post" id="add-customer-form">
			<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Firstname</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="first_name" id="" placeholder="Firstname">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Last Name</label>
					<div class="col-sm-10">
						<input type="text" class="form-control"  name="last_name" id="" placeholder="Lastname">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Contact</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="contact" id="" placeholder="Contact">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Email</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="email" id="" placeholder="Email">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Password</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="password" id="" placeholder="Password">
					</div>
				</div>
				
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Address</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="address" id="" placeholder="Address">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Role</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="customer" readonly name="role" id="" placeholder="Role">
					</div>
				</div>
					<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Role</label>
					<div class="col-sm-10">
						<input type="submit" class="form-control" value="Submit">
					</div>
				</div>

			</div>
		</form>
        </div>
        <div class="modal-footer text-center">
         <!--- <button type="button" class="btn btn-info" id="add-customer-btn">Create Customer</button> -->
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>


    <div id="editCustomerModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title text-center">Edit Customer</h4>
        </div>
        <div class="modal-body">
          <form action="/editcustomer" method="post" id="edit-customer-form">
			<div class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Firstname</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="first_name" id="" placeholder="Firstname">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Last Name</label>
					<div class="col-sm-10">
						<input type="text" class="form-control"  name="last_name" id="" placeholder="Lastname">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Contact</label>
					<div class="col-sm-10">
						<input type="text" value="" class="form-control" name="contact" id="" placeholder="Contact">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Email</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value=""  name="email" id="" placeholder="Email">
					</div>
				</div>

				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">New Password</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="password" id="" placeholder="Password">
					</div>
				</div>
				
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label">Address</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" value="" name="address" id="" placeholder="Address">
					</div>
				</div>
				<div class="form-customer row">
					<label for="emailInput" class="col-sm-2 col-form-label"></label>
					<div class="col-sm-10">
						<input type="submit" class="form-control" value="Submit">
					</div>
				</div>

			</div>
		</form>
        </div>
        <div class="modal-footer text-center">
          
          <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
	<div id="ajaxLoader" style="display:none;"></div>
</body>

<script >
$.get("/customers",function(){
								var socket=io.connect("http://localhost:3000")

		console.log("jquery get request")
	})


//var resarr = [];

						//var resarr = [];
						var socket=io.connect("http://localhost:3000")
						var q;
							// emitter.setMaxListeners(15);
							socket.on('data',function(result){
								//console.log("checking datatable")
								//resarr.push(data);
								/*	resarr.push({
										"address" : data.address,
										"contact" : data.contact,
										"email" : data.email,
										
										
										"first_name" : data.first_name,
										"id" : data.id,
										"last_name" : data.last_name,
										
										
										"link" : data.link,
										"password": data.password
										
									});
								
								
							})*/
							if(typeof q== 'undefined' )
							{
							q=$('#example').dataTable({
   "data": result,
   "columns": [
      { "data": "address" },
      { "data": "contact"}, 
			{ "data": "email"},
			{ "data": "first_name"},
			{ "data": "id"},
			{ "data": "last_name"},
      { 
         "data": "link",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="' + data + '">' + 'SETUP' + '</a>';
								//console.log(data);
            }
            
            return data;
         }
      },
			{ "data": "password"}, 
			{ 
         "data": "id",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="#" data-toggle="modal" class="edit-customer-anchor" data-target="#editCustomerModal" data-id="'+data+'" title="Edit" onclick="editclicked(this)"><i class="glyphicon glyphicon-pencil"></i></a>';
								//console.log(data);
            }
            
            return data;
         }
      },
			{ 
         "data": "id",
         "render": function(data, type, row, meta){
            if(type === 'display'){
							data='<a href="#" class="delete-customer-anchor" title="Delete" onclick="deleteclicked(this)" data-id="'+data+'"><i class="glyphicon glyphicon-remove"></i></a>'

								//console.log(data);
            }
            
            return data;
         }
      },
   ]
							});}
							else{
								q.fnDestroy();
								q=$('#example').dataTable({
   "data": result,
   "columns": [
      { "data": "address" },
      { "data": "contact"}, 
			{ "data": "email"},
			{ "data": "first_name"},
			{ "data": "id"},
			{ "data": "last_name"},
      { 
         "data": "link",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="' + data + '">' + 'SETUP' + '</a>';
								//console.log(data);
            }
            
            return data;
         }
      },
			{ "data": "password"}, 
			 { 
         "data": "id",
         "render": function(data, type, row, meta){
            if(type === 'display'){

                data = '<a href="#" data-toggle="modal" class="edit-customer-anchor" data-target="#editCustomerModal" data-id="'+data+'" title="Edit" onclick="editclicked(this)"><i class="glyphicon glyphicon-pencil"></i></a>';
								//console.log(data);
            }
            
            return data;
         }
			 },
			 { 
         "data": "id",
         "render": function(data, type, row, meta){
            if(type === 'display'){
							data='<a href="#" class="delete-customer-anchor" title="Delete" onclick="deleteclicked(this)" data-id="'+data+'"><i class="glyphicon glyphicon-remove"></i></a>'

								//console.log(data);
            }
            
            return data;
         }
      },
   ]
							});

							}
//							resarr = data;

							//console.log(data);
							})
//console.log("reached");

						
					
	/*$(".edit-customer-anchor").click(function(){
		var id = $(this).data('id');
		console.log("clicked",id);
		for(i=0;i<window.customers.length;i++){
			if(id==window.customers[i]['id']){
				window.current_customer = window.customers[i];
				$("[name='edit-first_name']").val(current_customer.first_name);
				$("[name='edit-last_name']").val(current_customer.last_name);
				$("[name='edit-contact']").val(current_customer.contact);
				$("[name='edit-email']").val(current_customer.email);
				$("[name='edit-address']").val(current_customer.address);
				break;
			}
		}
	});*/
	function editclicked(elem){
		var v = $(elem).attr("data-id")
		console.log(v);
		socket.emit("dataid",v)
	}
	function deleteclicked(elem){
		var v = $(elem).attr("data-id")
		socket.emit("deleteid",v);
		setTimeout(deletion,500)
		function deletion(){
			$.get("/customers",function(){
				//setTimeout(delay,500)
				//function delay(){
								var socket=io.connect("http://localhost:3000")
				//}
	//	console.log("jquery get request")
	})
		}

	}
		//var socket=io.connect("http://localhost:3000")
	
	

</script>
</html>